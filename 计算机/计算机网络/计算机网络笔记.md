# 计算机网络

[TOC]

## 一、概述

### 1.1 OSI模型

### 1.2 封装

在发送主机端，一个**应用层报文**（application-layer message）被传送给运输层。

运输层受到报文并附上附加信息，该首部将被接收端的运输层使用。应用层报文和运输层首部信息一道构成**运输层报文**（transport-layer segment），运输层报文因此而封装了应用层报文。附加信息包括允许接收端运输层向上向适当的应用程序教父报文的信息（例如差错检测信息）

运输层向网络层传递该报文段，网络层增加了如源和目的端系统地址等网络层首部信息，产生了**网络层数据报**（network-layer datagram）。

该数据报接下来传递给链路层，链路层增加它自己的链路层首部信息并创建**链路层帧**（link-layer frame）。

每一层中，一个分组具有两种类型的字段：首部字段和有效载荷字段（payload field），其中有效载荷字段来自上一层的分组



## 二、应用层

### 2.1 应用层协议原理

#### 进程通信

在操作系统的术语中，进行通信的实际上是进程（process）而不是程序。一个进程可以被认为是运行在端系统中的一个程序。当进程运行在相同的端系统上时，它们使用进程间通信机制相互通信。进程间通信的规则由端系统上的操作系统确定。在两个不同端系统上的进程，通过跨越计算机网络交换报文(message)而相互通信。发送进程生成并向网络中发送报文；接收进程接收这些报文并可能通过将报文发送回去进行响应。



#### 进程与计算机网络之间的接口

进程通过一个称为**套接字**（socket）的软件接口向网络发送报文和从网络接收报文。我们考虑一个类比来帮助我们理解进程和套接字。进程可类比于一座房子，而它的套接字可以类比于它的门。当一个进程想向位于另外一台主机上的另一个进程发送报文时，它把报文推出该门（套接字）。该发送进程假定该门到另外一侧之间有运输的基础设施，该设施将把报文传送到目的进程的门口。一旦该报文抵达目的主机，它通过接收进程的门（套接字）传递，然后接收进程对该报文进行处理。

套接字是同一台主机内应用层与运输层之间的接口。由于该套接字是建立网络应用程序的可编程接口，因此套接字也称为应用程序和网络之间的**应用程序编程接口**(Application Programming Interface,API)。应用程序开发者可以控制套接字在应用层端的一切，但是对该套接字的运输层端几乎没有控制权。应用程序开发者对于运输层的控制仅限于：

+ 选择运输层协议
+ 也许能设定几个运输层参数，如最大缓存和最大报文段长度等。

一旦应用程序开发者选择了一个运输层协议（如果可供选择的话），则应用程序就建立在由该协议提供的运输层服务之上。

> 套接字是IP地址和端口号的组合，例如192.168.1.101:6379



#### 进程寻址

为了向特定目的地发送邮政邮件，目的地需要有一个地址。类似地，在一台主机上运行的进程为了向在另一台主机上运行的进程发送分组，接收进程需要有一个地址。为了标识该接收进程，需要定义两种信息：

+ 主机的地址
+ 定义在目的主机中的接收进程的标识符。

在因特网中，主机由其**IP地址**（IP address）标识。IP地址是一个32比特的量且它能够唯一地标识该主机。除了知道报文送往目的地的主机地址外，发送进程还必须指定运行在接收主机上的接收进程（更具体地说，接收套接字)。因为一般而言一台主机能够运行许多网络应用，这些信息是需要的。目的地**端口号**(port number)用于这个目的。已经给流行的应用分配了特定的端口号。例如，Wb服务器用端口号80来标识。邮件服务器进程（使用SMTP协议)用端口号25来标识。

### 2.2 应用层协议

**应用层协议**定义了运行在不同端系统上的应用程序进程如何相互传递报文，特别定义了：

+ 交换的报文类型，例如请求报文和响应报文
+ 各种报文类型的语法，例如报文中各个字段及这些字段是如何描述的
+ 字段的语义，即这些字段中的信息的含义
+ 确定一个进程何时以及如何发送报文，对报文进行响应的规则



### 2.3 HTTP（HyperText Transfer Protocol）超文本传输协议

#### Web页面

Web页面是由对象组成的，一个对象是一个文件，例如一个HTML文件、一个JPEG图片或者一个Java小程序这样的可以通过URL地址寻址的文件



#### HTTP概况

HTTP定义了Web客户向Web服务器请求Web页面的方式，以及服务器向客户端传送Web页面的方式。当用户请求一个Web页面（例如点击一个超链接）时，浏览器向服务器发出对该页面中所包含对象的HTTP请求报文，服务器接收到请求并用包含这些对象的HTTP相应报文进行响应

**HTTP使用TCP作为它的支撑运输协议（而不是在UDP上运行）**，HTTP客户端首先发一个与服务器的TCP连接，一旦连接建立，该浏览器和服务器进程就可以通过套接字接口访问TCP。客户端向它的套接字接口发送HTTP请求报文并从它的套接字接口接收HTTP响应报文。相应的，服务器从它的套接字接口接收HTTP请求报文和它的套接字接口发送HTTP相应报文

HTTP是一个**无状态协议**（stateless protocol），HTTP服务器并不保存关于客户的任何信息。例如某个特定的客户在短短的几秒内两次请求同一个对象，服务器并不会因为刚刚为客户提供了该对象就不再做出反应，而是重新发送该对象，就像完全忘记不久前做的事一样。



#### 持续连接和非持续连接

非持续连接（non-persistent connection）：单个客户的每个请求和响应是一个单独的TCP进行发送的

持续连接：单个客户的所有的请求和响应都是同一个TCP连接发送的



#### 采用非持续连接的HTTP

## 三、运输成

### 3.1 概述

**运输层协议是在端系统中实现而不是在路由器中实现，并且运输层协议只工作在端系统中**。

在发送端，运输层将发送应用程序进程接收到的报文转换成运输层分组，也就是运输层**报文段**（segment），是通过将应用层报文划分为较小的块，并为每块加上一个运输层首部以生成运输层报文段并向目的地发送

### 3.1 因特网提供的运输服务

因特网为应用程序提供了两种运输层协议，即UDP和TCP，当为因特网创建一个新的引用时，首先要做出的决定是，选择UDP还是选择TCP，每个协议都为调用它们的应用提供了不同的服务集合

+ TCP服务
  + 面向连接的服务
    + 在应用层数据报文开始流动之前，TCP让客户和服务器相互交换运输层控制信息。这些所谓的握手过程提示客户和服务器，让它们为大量分组的到来做好准备。在握手阶段后，一个TCP连接就在两个进程的套接字之间建立了。这条连接时全双工的，即连接双方的进程可以在此连接上同时进行报文手法。当应用程序结束报文发送时，必须拆除该连接
  + 可靠的数据传送服务
    + 通信进程能够依靠TCP，无差错、按适当顺序交付所有发送的数据。当应用程序的一端将字节流传进套接字时，它能依靠TCP将相同的字节流交付给收方的套接字，而没有字节的丢失和冗余
  + 拥塞控制机制
+ UDP服务
  + 不提供不必要服务的轻量级运输协议，它仅提供最小服务。UDP是无连接的，因此在两个进程通信前没有握手过程。
  + UDP协议提供的是一种不可靠数据传送服务，当进程将报文发送进UDP套接字时，UDP协议并不保证该报文将到达接收进程，不仅如此，到达接收进程的报文可能是乱序到达的
  + UDP没有包括拥塞控制机制，所以UDP的发送端可以用它选定的任何速率向其下层（网络层）注入数据



> TCP安全
> 无论是TCP还是UDP**都没有提供任何加密机制**,这就是说发送进程传进其套接字的数据，与网络传送到目的进程的数据相同。也就是说如果某发送进程以明文方式（没有加密）发送了一个口令进入它的套接字，该明文口令将经过发送方与接收方之间的所有链路传送，这就可能在任何中间链路中被嗅探和发现。
>
> 因为隐私和其他安全问题对许多应用而言已经成为至关重要的问题，所以因特网已经研制了TCP的加强版本（**并不是运输层的第三种协议，而是在应用层上实现的**），称为**安全套接字层**（Secure Sockets Layer， SSL）。用SSL加强后的TCP不仅能够做传统TCP所能做的一切，而且提供了关键的进程到进程的安全性服务，包括加密、数据完整性和端点鉴别。
>
> 如果应用程序要使用SSL的服务，它需要在该应用程序的客户端和服务器端包括SSL代码(利用现有的、高度优化的库和类)。SSL有它自己的套接字API,这类似于传统的TCP套接字API。当一个应用使用SSL时，发送进程向SSL套接字传递明文数据；在发送主机中的SSL则加密该数据并将加密的数据传递给TCP套接字。加密的数据经因特网传送到接收进程中的TCP套接字。该接收套接字将加密数据传递给SSL,由其进行解密。最后，SSL通过它的SSL套接字将明文数据传递给接收进程。



## 四、网络层

### IP协议

IP的服务模型是**尽力而为交付服务**（best-effort delivery service）,它只是尽最大努力在通信的主机之间交付报文段，但它并不做任何保证，它不保证报文段的交付，不保证报文段的按需交付，不保证报文段中的数据的完整性。因此，IP被称为**不可靠服务**（unreliable service）
